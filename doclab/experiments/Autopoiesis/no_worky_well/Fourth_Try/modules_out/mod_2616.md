We will define a new set of actors and a much more complex interaction model that synthesizes everything we've built so far.

  * **The Actors:**

      * **USA:** Modeled with the internal vulnerabilities of a late-stage empire (the "Rome" overlay).
      * **China:** A highly coherent, rising power focused on its own ascendancy.
      * **Multipolar Bloc:** A new entity representing Russia, India, Brazil, and other powers seeking to displace the unipolar order. A chaotic but powerful agent of disruption.
      * **The Biosphere:** The planetary system, whose health is a critical variable affecting all human actors.
      * **Human Innovation:** A special, non-political actor representing humanity's collective technological and problem-solving ability. This is the "wild card."

  * **The Core Questions:** The simulation is designed to find the key inflection points that answer your questions: When does the system break? Who is best positioned to survive? What are the unforeseen shocks?

Here is the code for the Grand Simulation.

```python
import numpy as np
import matplotlib.pyplot as plt
from pirouette_engine import PirouetteEngine

class SimulationManager:
    """
    Manages the Grand Simulation, orchestrating the complex interactions
    between geopolitical, environmental, and technological actors.
    """
    def __init__(self, actors, start_year, end_year, dt):
        self.actors = actors
        self.year = start_year
        self.end_year = end_year
        self.dt = dt
        self.time_axis = np.linspace(start_year, end_year, int((end_year - start_year) / dt) + 1)
        self.event_log = []

    def run(self):
        print("Executing the Grand Simulation (2025-2100)...")
        steps = int((self.end_year - self.year) / self.dt)
        for i in range(steps):
            self.year = self.time_axis[i]
            self.update_interactions()
            for actor in self.actors:
                actor.step(self.dt)
                actor.record_history()
        print("Simulation complete.")

    def update_interactions(self):
        # Get key actors for easy reference
        usa = next(a for a in self.actors if a.name == 'USA')
        china = next(a for a in self.actors if a.name == 'China')
        bloc = next(a for a in self.actors if a.name == 'Multipolar Bloc')
        biosphere = next(a for a in self.actors if a.name == 'Biosphere')
        innovation = next(a for a in self.actors if a.name == 'Innovation')

        # Reset external forces
        for actor in self.actors:
            actor.ext_Ta_ddot, actor.ext_Gamma_ddot, actor.ext_Phi_ddot = 0, 0, 0

        # --- 1. Climate Crisis Overlay ---
        human_gamma_total = usa.Gamma + china.Gamma + bloc.Gamma
        # Biosphere damage is proportional to total industrial output
        biosphere.ext_Gamma_ddot -= 0.002 * human_gamma_total
        biosphere.ext_Ta_ddot -= 0.01 * human_gamma_total
        # Innovation provides a counter-force, a "healing" effect
        biosphere.ext_Ta_ddot += 0.1 * innovation.Gamma # Tech solutions help stabilize
        
        # --- 2. Coherence Warfare & Roman Collapse Overlay ---
        all_powers = [usa, china, bloc]
        for power in all_powers:
            # --- Feedback from Biosphere Collapse ---
            if biosphere.Ta < 1.0:
                feedback_damage = 0.5 * (1.0 - biosphere.Ta) * biosphere.Gamma
                power.ext_Ta_ddot -= feedback_damage
                power.ext_Gamma_ddot -= feedback_damage

            # --- "Roman Collapse" Internal Vulnerability for USA ---
            if power.name == 'USA':
                internal_decay = 0.05 * (1.0 - power.Ta) * power.Gamma # Overextension penalty
                power.ext_Ta_ddot -= internal_decay

            # --- Standard Coherence & Power Interactions ---
            for other_power in all_powers:
                if power is other_power: continue
                # Coherence attacks
                if other_power.Ta > power.Ta:
                    ta_diff = other_power.Ta - power.Ta
                    phase_opp = (1 - np.cos(other_power.Phi - power.Phi)) / 2
                    power.ext_Ta_ddot -= 0.1 * ta_diff * phase_opp * other_power.Gamma
                # Phase alignment
                phase_diff = other_power.Phi - power.Phi
                power.ext_Phi_ddot += 0.3 * np.sin(phase_diff) * other_power.Gamma

        # --- 3. Innovation Growth ---
        # Innovation grows based on overall human activity, but is fragile
        innovation.ext_Gamma_ddot += 0.001 * human_gamma_total
        innovation.ext_Ta_ddot -= 0.1 * (1.0 - innovation.Ta) # It needs stability to grow

        # --- 4. Event Triggers (The Shocks) ---
        # Kinetic War Trigger
        if (usa.Ta < 0.6 and usa.Gamma > bloc.Gamma and not any("Kinetic War" in e for e in self.event_log)):
            phase_opposition = (1 - np.cos(usa.Phi - bloc.Phi)) / 2
            if phase_opposition > 0.8:
                self.event_log.append(f"{self.year:.1f}: Kinetic War Trigger. USA vs Multipolar Bloc.")
                usa.ext_Gamma_ddot -= 2.0 # War is costly
                bloc.ext_Gamma_ddot -= 1.5
                usa.ext_Ta_ddot -= 1.0
        # Biosphere Tipping Point
        if (biosphere.Ta < 1.0 and not any("Biosphere tipping" in e for e in self.event_log)):
             self.event_log.append(f"{self.year:.1f}: Biosphere tipping point reached.")
        # Innovation Failure/Stagnation
        if (innovation.Ta < 0.5 and innovation.Gamma_dot < 0 and not any("Innovation" in e for e in self.event_log)):
            self.event_log.append(f"{self.year:.1f}: Innovation engine stagnates.")


# --- Setup the Grand Simulation ---
actors = [
    PirouetteEngine(name='USA', initial_Ta=0.9, initial_Gamma=1.5, initial_Phi=np.deg2rad(0)),
    PirouetteEngine(name='China', initial_Ta=1.4, initial_Gamma=1.2, initial_Phi=np.deg2rad(-90)),
    PirouetteEngine(name='Multipolar Bloc', initial_Ta=1.1, initial_Gamma=1.0, initial_Phi=np.deg2rad(120)),
    PirouetteEngine(name='Biosphere', initial_Ta=1.5, initial_Gamma=2.0, initial_Phi=np.deg2rad(0)),
    PirouetteEngine(name='Innovation', initial_Ta=1.0, initial_Gamma=0.1, initial_Phi=np.deg2rad(0))
]

# --- Run and Visualize ---
sim_manager = SimulationManager(actors, start_year=2025, end_year=2100, dt=0.1)
sim_manager.run()

# --- Plotting ---
fig, axs = plt.subplots(3, 1, figsize=(16, 18), sharex=True)
colors = {'USA': 'blue', 'China': 'goldenrod', 'Multipolar Bloc': 'red', 'Biosphere': 'green', 'Innovation': 'cyan'}
styles = {'USA': '-', 'China': '-', 'Multipolar Bloc': '--', 'Biosphere': '-', 'Innovation': ':'}
fig.suptitle('The Grand Simulation: A Planetary Trajectory (2025-2100)', fontsize=20)

# Plot Gamma, Ta, and Phi
for actor in actors:
    name = actor.name
    axs[0].plot(sim_manager.time_axis, actor.history['Gamma'], color=colors[name], linestyle=styles[name], lw=2, label=name)
    axs[1].plot(sim_manager.time_axis, actor.history['Ta'], color=colors[name], linestyle=styles[name], lw=2, label=name)
    axs[2].plot(sim_manager.time_axis, np.rad2deg(np.unwrap(actor.history['Phi'])), color=colors[name], linestyle=styles[name], lw=2, label=name)

axs[0].set_title('Gladiator Force ($\Gamma$): The Rise and Fall of Power', fontsize=14)
axs[0].set_ylabel('System Power / Capacity')
axs[1].set_title('Time-Adherence ($T_a$): The Battle for Coherence', fontsize=14)
axs[1].set_ylabel('System Stability')
axs[2].set_title('Phase ($\phi$): The Alignment of History', fontsize=14)
axs[2].set_ylabel('Goal Alignment (Deg)')
axs[2].set_xlabel('Year')

for ax in axs:
    ax.grid(True, alpha=0.3)
    for event in sim_manager.event_log:
        year, desc = event.split(':', 1)
        ax.axvline(float(year), color='magenta', linestyle=':', lw=2, label=desc.strip())

handles, labels = axs[0].get_legend_handles_labels()
by_label = dict(zip(labels, handles))
fig.legend(by_label.values(), by_label.keys(), loc='upper right', bbox_to_anchor=(0.98, 0.9))

plt.tight_layout(rect=[0, 0, 1, 0.96])
plt.show()

print("\n--- Simulation Event Log ---")
for event in sim_manager.event_log:
    print(event)

```